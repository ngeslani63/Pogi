@using Pogi.Models.LiveViewModels
@model LiveSelectViewModel ;

@{
    ViewData["Title"] = "Live Tournament Scoring";
}
    <section class="container">
        <br />
        <h2>Live Scoring</h2>
        <h3>Select Group</h3>
        <hr />
        <form class="px-0" asp-action="Live" method="get">
        <section class="row">
            <div class="col">
                @*<form class="px-0" asp-action="Live" method="get">*@
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Tour</span>
                        </div>
                        <select asp-for="TourId" asp-items="@Model.Tours" class="form-control"></select>
                        <div class="input-group-append">
                            <select asp-for="TourDate" asp-items="@Model.TourDates" class="form-control"></select>
                        </div>
                        <div class="input-group-addon">
                            <input hidden id="SetTour" type="submit"
                                   formaction=@Url.Action("Index")
                                   name="SetTour" value="SetTour" class="btn btn-primary" />
                        </div>
                    </div>
                @*</form>*@
            </div>
        </section>
        <hr />
        @{
            TeeTimeInfo teeTimeInfo = Model.TeeTimeInfo;
            if (teeTimeInfo != null)
            {
                TeeTime teeTime = teeTimeInfo.TeeTime;
                String teeTimeDisp = teeTime.TeeTimeTS.ToString("f");
                Member member = teeTimeInfo.Member;
                Course course = teeTimeInfo.Course;
                var teeAssignInfos = teeTimeInfo.TeeAssignInfos;
            <section class="row ">
                <div class="col-4 alert-info px-3">
                    @Html.DisplayNameFor(model => course.CourseName)
                </div>
                <div class="col alert-secondary px-3">
                    @Html.DisplayFor(modelItem => course.CourseName)
                </div>
            </section>
            <hr />
                int group = 0;
                DateTime startTime = teeTime.TeeTimeTS;
            @if (teeTime.NumPlayers > 0)
                {
            <section class="row">
                <div class="col-5">
                    <div class="list-group" id="list-tab" role="tablist">
                        @for (int i = 0; i < teeTime.NumPlayers; i++)

                            {
                        @if (teeTime.MajorTour && teeTime.NumPlayers > 4 && i % 4 == 0)
                                {
                                    group++;
                                    var opts = "active";
                        @if (group > 1) { opts = ""; }
                        <a class="list-group-item list-group-item-action px-2 @opts"
                           id="list-group@(group)-list"
                           data-toggle="list" href="#list-group@(group)" role="tab"
                           aria-controls="group@(group)">
                            <small>
                                Group @group
                                @startTime.ToShortTimeString()
                            </small>
                        </a>
                                    startTime = startTime.AddMinutes(teeTime.TeeTimeInterval);
                                }

                            }
                    </div>
                </div>
                @{group = 0;
                      startTime = teeTime.TeeTimeTS;
                }
                <div class="col-7 pl-0">
                    <div class="tab-content" id="nav-tabContent">

                        @for (int i = 0; i < teeTime.NumPlayers; i++)
                            {
                        @if (teeTime.MajorTour && i % 4 == 0)
                                {
                                    group++;
                                    startTime = startTime.AddMinutes(teeTime.TeeTimeInterval);

                                    var opts = "fade show active";
                        @if (group > 1)
                                    { opts = "fade";
                                    }
                        <div class="tab-pane @opts" id="list-group@(group)" role="tabpanel"
                             aria-labelledby="list-group@(group)-list">
                            <table class="table table-hover">
                                <thead class="thead-light">
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">Player</th>
                                        <th scope="col">H.I.</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @for (int j=i ; j < teeTime.NumPlayers && j < i+4 ; j++)
                                        {
                                    <tr scope="row">
                                        <th>@(j % 4 + 1). </th>

                                        @if (j < teeAssignInfos.Count)
                                                {
                                                    var teeAssignInfo = teeAssignInfos[j];
                                        @if (teeAssignInfo.TeeAsign.MemberId > 0)
                                                    {
                                        @if (teeAssignInfo.TeeAsign.GuestName != null && teeAssignInfo.TeeAsign.GuestName.Length > 0)
                                                        {
                                        <td>@teeAssignInfo.TeeAsign.GuestName</td>

                                                        }
                                                        else
                                                        {
                                        <td>
                                            <small>
                                                @teeAssignInfo.Member.FirstName
                                                @teeAssignInfo.Member.LastName
                                            </small>
                                        </td>
                                        @if (teeAssignInfo.Member.CurrHandicap > 0)
                                                            {
                                        <td>@teeAssignInfo.Member.CurrHandicap</td>
                                                            }
                                                            else
                                                            {
                                        <td>(NH)</td>

                                                            }
                                                        }
                                                    }
                                                    else
                                                    {
                                        <td class="text-muted">Unassigned</td>
                                                    }
                                                }
                                                else
                                                {
                                        <td class="text-muted">Unassigned</td>
                                                }

                                    </tr>
                                         }
                                </tbody>
                            </table>
                        </div>
                                }
                            }


                    </div>
                </div>
            </section>
            @*<form class="px-0" asp-action="Live" method="get">*@
                <section class="row mt-0">
                    <button type="submit" formaction=@Url.Action("Score") class="col-11 py-3 mx-3 mt-0 d-block bg-primary text-light rounded">Select this Group and Score it Live</button>
                </section>
            @*</form>*@

                }

            }
        }
        </form>
    </section>

@section Scripts {
    <script>
        console.info("Hello From Live Scoring");

        $("#TourId").change(function () {
            console.info("TourId changed");
            $("#SetTour").trigger("click");
            $("#TourDate").val("");
        });
        $("#TourDate").change(function () {
            console.info("TourId changed");
            $("#SetTour").trigger("click");
        });


    </script>
}
