@using Pogi.Models.LiveViewModels
@model LiveSelectViewModel ;

@{
    ViewData["Title"] = "Live Tournament Scoring";
}
<section class="container">
        <br />
        <h2>Live Scoring</h2>
        <h3>Select Group</h3>
        <hr />
        <section class="row">
            <div class="col">
                <form class="px-0" asp-action="Live" method="get">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Tour</span>
                        </div>
                        <select asp-for="TourId" asp-items="@Model.Tours" class="form-control"></select>
                        <div class="input-group-append">
                            <select asp-for="TourDate" asp-items="@Model.TourDates" class="form-control"></select>
                        </div>
                        <div class="input-group-addon">
                            <input hidden id="SetTour" type="submit" name="SetTour" value="SetTour" class="btn btn-primary" />
                        </div>
                    </div>
                </form>
            </div>
        </section>
        <hr />

        @{
            TeeTimeInfo teeTimeInfo = Model.TeeTimeInfo;
            if (teeTimeInfo != null)
            {
                TeeTime teeTime = teeTimeInfo.TeeTime;
                String teeTimeDisp = teeTime.TeeTimeTS.ToString("f");
                Member member = teeTimeInfo.Member;
                Course course = teeTimeInfo.Course;
                var teeAssignInfos = teeTimeInfo.TeeAssignInfos;
                <section class="row">
                    <div class="col-4 alert-info px-3">
                        @Html.DisplayNameFor(model => course.CourseName)
                    </div>
                    <div class="col alert-secondary px-3">
                        @Html.DisplayFor(modelItem => course.CourseName)
                    </div>
                </section>
                <hr />

                int group = 0;
                DateTime startTime = teeTime.TeeTimeTS;
                @if (teeTime.NumPlayers > 0)
                {
                <section class="row">
                    <div class="col-4">
                        <div class="list-group" id="list-tab" role="tablist">
                            @for (int i = 0; i < teeTime.NumPlayers; i++)

                            {
                                if (teeTime.MajorTour && teeTime.NumPlayers > 4 && i % 4 == 0)
                                {
                                    group++;
                                    var opts = "active";
                                    if (group > 1) { opts = ""; }
                                    <a class="list-group-item list-group-item-action @opts"
                                       id="list-group@(group)-list"
                                       data-toggle="list" href="#list-group@(group)" role="tab"
                                       aria-controls="group@(group)">
                                        Group @group 
                                        <br />
                                        Start Time  @startTime.ToShortTimeString()
                                    </a>
                                    startTime = startTime.AddMinutes(teeTime.TeeTimeInterval);
                                }

                            }
                        </div>
                    </div>
                    @{group = 0;
                      startTime = teeTime.TeeTimeTS;
                    }
                    <div class="col-8">
                        <div class="tab-content" id="nav-tabContent">
                            
                            @for (int i = 0; i < teeTime.NumPlayers; i++)
                            {
                                @if (teeTime.MajorTour && teeTime.NumPlayers > 4 && i % 4 == 0)
                                {
                                    group++;
                                    startTime = startTime.AddMinutes(teeTime.TeeTimeInterval);

                                    var opts = "fade show active";
                                    if (group > 1) { opts = "fade"; }
                                    <div class="tab-pane @opts" id="list-group@(group)" role="tabpanel"
                                        aria-labelledby="list-group@(group)-list">
                                }

                                Player @(i + 1)
                                @if (i < teeAssignInfos.Count)
                                {
                                    var teeAssignInfo = teeAssignInfos[i];
                                    @if (teeAssignInfo.TeeAsign.MemberId > 0)
                                    {
                                        @if (teeAssignInfo.TeeAsign.GuestName != null && teeAssignInfo.TeeAsign.GuestName.Length > 0)
                                        {
                                            <span>@teeAssignInfo.TeeAsign.GuestName</span>

                                        }
                                        else
                                        {
                                            <span>@teeAssignInfo.Member.FirstName</span>
                                            <span>@teeAssignInfo.Member.LastName</span>
                                            @if (teeAssignInfo.Member.CurrHandicap > 0)
                                            {
                                                <span>(@teeAssignInfo.Member.CurrHandicap)</span>
                                            }
                                            else
                                            {
                                                <span>(NH)</span>

                                            }
                                        }
                                    }
                                    else
                                    {
                                        <span class="text-muted">Unassigned</span>
                                    }
                                }
                                else
                                {
                                    <span class="text-muted">Unassigned</span>
                                }
                                @if (teeTime.MajorTour && teeTime.NumPlayers > 4 && i % 4 == 0)
                                {
                                    </div>
                                }
                            }

                            
                        </div>
                    </div>
                </section>
                }
            }
        }
     </section>






@section Scripts {
    <script>
        console.info("Hello From Live Scoring");

        $("#TourId").change(function () {
            console.info("TourId changed");
            $("#SetTour").trigger("click");
            $("#TourDate").val("");
        });
        $("#TourDate").change(function () {
            console.info("TourId changed");
            $("#SetTour").trigger("click");
        });


    </script>
}
